<!DOCTYPE html>
<!-- saved from url=(0083)https://issues.openmrs.org/si/jira.issueviews:issue-html/TRUNK-3401/TRUNK-3401.html -->
<html class="webkit chrome gr__issues_openmrs_org"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>[#TRUNK-3401] deprecated method Encounter.setProvider against 1.9 needs to be adjusted</title>
    
            
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"jira.create.linked.issue\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-075/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.request.correlation-id"]="\"ef6b0b1a2a1b84\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script>
<link type="text/css" rel="stylesheet" href="./TRUNK-3401_files/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<link type="text/css" rel="stylesheet" href="./TRUNK-3401_files/com.atlassian.auiplugin_aui-labels.css" data-wrm-key="com.atlassian.auiplugin:aui-labels" data-wrm-batch-type="resource" media="all">
<link type="text/css" rel="stylesheet" href="./TRUNK-3401_files/jira.webresources_global-static.css" data-wrm-key="jira.webresources:global-static" data-wrm-batch-type="resource" media="all">
<script type="text/javascript" src="./TRUNK-3401_files/batch.js" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered=""></script><style></style><style type="text/css"></style><style type="text/css"></style>

        <style type="text/css">

.tableBorder, .grid
{
    background-color: #fff;
    width: 100%;
    border-collapse: collapse;
}

.tableBorder td, .grid td
{
    vertical-align: top;
    padding: 2px;
    border: 1px solid #ccc;
}

.noPadding
{
    padding: 0 !important;
}

h3 .subText
{
    font-size: 60%;
    font-weight: normal;
}

.tabLabel
{
    font-weight: bold;
    border: 1px solid #ccc;
    border-bottom:none;
    padding: 2px;
    display: inline;
}

td.blank
{
    padding: 0;
    margin: 0;
}

.blank td
{
    border: none;
}

#descriptionArea
{
    margin: 0;
    padding: 2px;
    border: 1px solid #ccc;
}

hr
{
    border-top:1px solid #aaa;
}

hr.fullcontent
{
  height: 15px;
  padding: 10px 0;
  background: #fff url('https://issues.openmrs.org/images/icons/hr.gif') no-repeat scroll center;
}

</style>

</head>
<body data-gr-c-s-loaded="true" data-aui-version="6.0.0">
<header id="previous-view">
    <nav class="aui-toolbar">
        <div class="toolbar-split toolbar-split-right">
            <ul class="toolbar-group">
                <li class="toolbar-item">
                    <a href="https://issues.openmrs.org/browse/TRUNK-3401" class="toolbar-trigger">Back to previous view</a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<table class="tableBorder" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tbody><tr>
        <td bgcolor="#f0f0f0" width="100%" colspan="2" valign="top">
                            <h3 class="formtitle">
                        [TRUNK-3401]&nbsp;<a href="https://issues.openmrs.org/browse/TRUNK-3401">deprecated method Encounter.setProvider against 1.9 needs to be adjusted</a>
            <span class="subText">
               Created: 2012-06-01                   &nbsp;Updated: 2018-04-12

                                            </span>
            </h3>
        </td>
    </tr>
    <tr>
        <td width="20%"><b>Status:</b></td>
        <td width="80%">Code Review (Initial)</td>
    </tr>
    <tr>
        <td width="20%"><b>Project:</b></td>
        <td width="80%"><a href="https://issues.openmrs.org/secure/BrowseProject.jspa?id=10000">OpenMRS Core</a></td>
    </tr>

        <tr>
            <td><b>Component/s:</b></td>
            <td>
                            None
                </td>
    </tr>
    

        <tr>
            <td><b>Affects Version/s:</b></td>
            <td>
                                        <a title="OpenMRS 1.9.0" href="https://issues.openmrs.org/issues/?jql=project%3D10000%20AND%20%22affectedVersion%22%3D12563%20ORDER%20BY%20priority%20ASC">OpenMRS 1.9.0</a>                        </td>
    </tr>
    

        <tr>
            <td><b>Fix Version/s:</b></td>
            <td>
                                        <a title="1.9.x" href="https://issues.openmrs.org/issues/?jql=project%3D10000%20AND%20%22fixVersion%22%3D22600%20ORDER%20BY%20priority%20ASC">1.9.x</a>                        </td>
    </tr>
    
    </tbody></table>

<br>
<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tbody><tr>
        <td bgcolor="#f0f0f0" valign="top" width="20%">
            <b>Type:</b>
        </td>
        <td bgcolor="#ffffff" valign="top" width="30%">
            Bug
        </td>

                    <td bgcolor="#f0f0f0">
                <b>Priority:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap="">
                Must
            </td>
            </tr>
    <tr>
                        <td bgcolor="#f0f0f0" valign="top" width="20%">
                <b>Reporter:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" width="30%">
                                            <a class="user-hover" rel="dthomas" id="word_reporter_dthomas" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=dthomas">Dave Thomas</a>
                            </td>
        
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Assignee:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap="" width="30%">
                                            <a class="user-hover" rel="willhoss" id="word_assignee_willhoss" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=willhoss">William Hoss</a>
                            </td>
            </tr>
    	<tr>
		<td bgcolor="#f0f0f0" width="20%">
			<b>Resolution:</b>
		</td>
		<td bgcolor="#ffffff" valign="top" width="30%" nowrap="">
            				Unresolved
                    </td>
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Votes:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" width="30%" nowrap="">
                0
            </td>
        
    </tr>
    
        <tr>
        <td bgcolor="#f0f0f0" width="20%">
            <b>Labels:</b>
        </td>
        <td id="labels-68292-value" class="value" bgcolor="#ffffff" valign="top" colspan="3" nowrap="">
                            curated, icap-training17                    </td>
    </tr>
    
    	<tr>
        		<td bgcolor="#f0f0f0" width="20%"><b>Remaining Estimate:</b></td>
        <td bgcolor="#ffffff" valign="top" nowrap="" width="80%" colspan="3">
                            0 minutes
            		</td>
    </tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Time Spent:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap="" width="80%" colspan="3">
                            1 day, 1 hour
            		</td>
	</tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Original Estimate:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap="" width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    
    </tbody></table>



    <br>

    	<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
            

        
    



                        <tbody><tr>
                <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Complexity:</b></td>
                <td id="customfield_10020-68292-value" class="value" bgcolor="#ffffff" width="80%">    Low
</td>
            </tr>
                                <tr>
                <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Watchers:</b></td>
                <td id="customfield_10121-68292-value" class="value" bgcolor="#ffffff" width="80%">    <div class="shorten" id="customfield_10121-field">
                                    <span class="tinylink">        <span class="user-hover" rel="bwolfe" id="multiuser_cf_bwolfe">Ben Wolfe</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="burke" id="multiuser_cf_burke">Burke Mamlin</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="dkayiwa" id="multiuser_cf_dkayiwa">Daniel Kayiwa</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="darius" id="multiuser_cf_darius">Darius Jazayeri</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="dthomas" id="multiuser_cf_dthomas">Dave Thomas</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="gnyamach" id="multiuser_cf_gnyamach">Gideon Nyamachere</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="k.joseph" id="multiuser_cf_k.joseph">Kaweesi Joseph</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="mogoodrich" id="multiuser_cf_mogoodrich">Mark Goodrich</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="mseaton" id="multiuser_cf_mseaton">Mike Seaton</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="maoengm" id="multiuser_cf_maoengm">Monaheng Maoeng</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="raff" id="multiuser_cf_raff">Rafal Korytkowski</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="mwelazek" id="multiuser_cf_mwelazek">Teboho Koma</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="monyatsithulo" id="multiuser_cf_monyatsithulo">Thulo Monyatsi</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="tlohang" id="multiuser_cf_tlohang">Tlohang Moeketse</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="willhoss" id="multiuser_cf_willhoss">William Hoss</span></span>,                                                 <span class="tinylink">        <span class="user-hover" rel="wyclif" id="multiuser_cf_wyclif">Wyclif Luyima</span></span>                        </div>
</td>
            </tr>
            </tbody></table>

    <br>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tbody><tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap="" align="center">
            &nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </tbody></table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tbody><tr>
        <td id="descriptionArea">
            <p>OpenMRS1.9</p>

<p>If you pass deprecated method encounter.setProvider(User) a User that does not have a Provider object associated, this throws an error.  This isn't good backwards-compatibility deprecation for module support.</p>

<p>I'd propose that this method now create the User's Provider object if it doesn't exist on the assumption that if someone meant that a given User be the Encounter's provider, its probably OK to make that User a Provider.</p>

<p>TODOs</p>
<ul class="alternate" type="square">
	<li>Add a convenience method to ProviderService that takes a user and creates a provider record for them.</li>
	<li>Confirm with Dave/Mark if they really need this to behave as Dave is describing, create a patch that does this only if you switch a global property to true (but have it default to false).</li>
	<li>Create a Providers wiki page and with a groovy script that will show which of the users don't have provider records, and another script that will add provider records for those users</li>
</ul>


            <br>
        </td>
    </tr>
    </tbody></table>

    <br>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tbody><tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap="" align="center">
            &nbsp;<font color="#ffffff"><b>Comments</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </tbody></table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%" class="grid" style="margin: 0;">
                <tbody><tr id="comment-header-186510"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="bwolfe" id="word_commented_bwolfe" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=bwolfe">Ben Wolfe</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-06-04</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-186510"><td bgcolor="#ffffff">
            <p>I see two problems: <br>
1) We don't really want to do this from the pojo, no way to roll back if that encounter is never submitted<br>
2) If the current user doesn't have Add Provider privileges it would fail.</p>
        </td></tr>
                <tr id="comment-header-188404"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="dkayiwa" id="word_commented_dkayiwa" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=dkayiwa">Daniel Kayiwa</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188404"><td bgcolor="#ffffff">
            <p>@Dave and others, any comments based on Ben's feedback?</p>
        </td></tr>
                <tr id="comment-header-188484"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="burke" id="word_commented_burke" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=burke">Burke Mamlin</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-17</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188484"><td bgcolor="#ffffff">
            <p>I'd favor adding a convenience method in the ProviderService for creating a provider out of a User.  Then we could provide a script that makes provider records for all current users.  In the Groovy module, this would be something like</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">users.allUsers.findAll{ <span class="code-comment">/* filter users */</span> }.each{ provider.createProviderFromUser(it) }
</pre>
</div></div>
        </td></tr>
                <tr id="comment-header-188545"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="mogoodrich" id="word_commented_mogoodrich" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=mogoodrich">Mark Goodrich</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-18</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188545"><td bgcolor="#ffffff">
            <p>Automatically upgrading a user to a provider when you do a setProvider(User) does seem a iffy to me... but, as Dave said, this is definitely an issue because it breaks backwards capability.</p>

<p>The underlying problem here is that during the upgrade to 1.9, the liquibase script goes through and creates provider objects for all users/people that are currently set as providers on existing encounters.  The issue is:</p>

<p>1) If you have valid users/providers that have never been associated with an encounter before, they won't have an associated provider associated with them, so if you choose them as an encounter provider, an exception will be thrown.</p>

<p>2) When you add new providers, administrators need to know that they new to actually add them as providers in the system, not just as users.</p>

<p>#1 seems the most problematic to me, because it leads to a situation where upgrading to 1.9 can break existing functionality. </p>

<p>Not quite sure what the answer is.  I don't know if we've really want to make a provider records for <b>all</b> users in the system.</p>

        </td></tr>
                <tr id="comment-header-188546"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="bwolfe" id="word_commented_bwolfe" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=bwolfe">Ben Wolfe</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-18</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188546"><td bgcolor="#ffffff">
            <p>I like Burke's suggestion of a convenience method and just use groovy. Add some examples about how to get users with a certain role so that you don't have to do it for all users.</p>
        </td></tr>
                <tr id="comment-header-188709"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="dkayiwa" id="word_commented_dkayiwa" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=dkayiwa">Daniel Kayiwa</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188709"><td bgcolor="#ffffff">
            <p>Should i change this to Needs Design?</p>
        </td></tr>
                <tr id="comment-header-188722"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="mogoodrich" id="word_commented_mogoodrich" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=mogoodrich">Mark Goodrich</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-20</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-188722"><td bgcolor="#ffffff">
            <p>I would agree with Needs Design</p>
        </td></tr>
                <tr id="comment-header-189066"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="darius" id="word_commented_darius" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=darius">Darius Jazayeri</a>
                                        <font size="-2">
            [
                <font color="#336699">2012-07-25</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-189066"><td bgcolor="#ffffff">
            <p>I'm setting the fixVersion to 1.9.1 because this should be treated as a bug, not a new feature.</p>
        </td></tr>
                <tr id="comment-header-242534"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="k.joseph" id="word_commented_k.joseph" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=k.joseph">Kaweesi Joseph</a>
                                        <font size="-2">
            [
                <font color="#336699">2017-11-23</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-242534"><td bgcolor="#ffffff">
            <p>ICAP (Lesotho) Training team first commit to this:&nbsp;<a href="https://github.com/openmrs/openmrs-core/pull/2297" class="external-link" rel="nofollow">https://github.com/openmrs/openmrs-core/pull/2297</a></p>
        </td></tr>
                <tr id="comment-header-247274"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="gnyamach" id="word_commented_gnyamach" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=gnyamach">Gideon Nyamachere</a>
                                        <font size="-2">
            [
                <font color="#336699">2018-04-05</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-247274"><td bgcolor="#ffffff">
            <p>We have a pull request: <a href="https://github.com/openmrs/openmrs-core/pull/2625" class="external-link" rel="nofollow">https://github.com/openmrs/openmrs-core/pull/2625</a>&nbsp;</p>

<p>Please review and merge.</p>
        </td></tr>
                <tr id="comment-header-247275"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="willhoss" id="word_commented_willhoss" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=willhoss">William Hoss</a>
                                        <font size="-2">
            [
                <font color="#336699">2018-04-05</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-247275"><td bgcolor="#ffffff">
            <p>pull request here:&nbsp;<a href="https://github.com/openmrs/openmrs-core/pull/2625" class="external-link" rel="nofollow">https://github.com/openmrs/openmrs-core/pull/2625</a>&nbsp;<img class="emoticon" src="./TRUNK-3401_files/thumbs_up.png" height="16" width="16" align="absmiddle" alt="" border="0"></p>
        </td></tr>
                <tr id="comment-header-247483"><td bgcolor="#f0f0f0">
            Comment by  
                                                        <a class="user-hover" rel="gnyamach" id="word_commented_gnyamach" href="https://issues.openmrs.org/secure/ViewProfile.jspa?name=gnyamach">Gideon Nyamachere</a>
                                        <font size="-2">
            [
                <font color="#336699">2018-04-12</font>

                            ]
            </font>

        </td></tr>
        <tr id="comment-body-247483"><td bgcolor="#ffffff">
            <p>A pull request here: <a href="https://github.com/openmrs/openmrs-core/pull/2625" class="external-link" rel="nofollow">https://github.com/openmrs/openmrs-core/pull/2625</a>&nbsp;</p>
        </td></tr>
            </tbody></table>
Generated at Mon Apr 16 22:28:34 UTC 2018 using JIRA 7.5.1#75006-sha1:7df2574a6cc842da727f00de4c5ce9ac07701368.


</body></html>